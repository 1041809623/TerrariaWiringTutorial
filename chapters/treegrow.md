### 树木生长规律

<sup>玩家附近：指任意玩家中心的左右**sWidth * 0.6**（默认72格），上下**sHeight * 0.6**（默认40.5格）范围内。</sup>

树木生长只会发生在地图中的矩形区域内。

地表树类的矩形区域左右端和上端均距离地图边缘10格，下端为地表（worldSurface）。

每次更新中，重复以下步骤（世界宽度 * 世界高度 * 0.00003）次：

* 随机选取地表矩形区域内的一个图格。

* 如果该格内方块类型为橡树种（ID 20）
  
  * 该格内液体量不超过32（约八分之一）
  
  * 位于玩家附近

  * 如果满足了本步骤中所有条件，则有**1 / 20**的几率进入下一步，树木生长。

    根据类型不同，树木生长也会有不同的代码，分为普通树木和海边的棕榈木。

* 如果该格内方块类型为丛林草地（ID 60）

  * 有**1 / 7**的几率检测该图格上方有没有方块，如果没有，则长出丛林草。

  * 如果符合以下条件，则有**1 / 500**的几率长出树木（该格视为树根下方的方块）

    * 上一步中没有触发检测

    * 该图格上方没有方块，或只有丛林草/刺

    * 位于玩家附近

* 如果该格内方块类型为蘑菇草（ID 70）

  * 有**1 / 10**的几率长出小蘑菇。

* 如果位于玩家附近，则有**1 / 100**的几率长出地表蘑菇树。

    * 该格视为树根下方的方块。

游戏会根据该图格的位置向下寻找最高的非橡树种方块，并将其标记为树根下方的方块。该方块上方相邻的方块标记为树根。

地下树类的矩形区域左右端均距离地图边缘10格，上端为地表，下端为距离地图边缘20格。

每次更新中，重复以下步骤（世界宽度 * 世界高度 * 0.000015）次：

* 随机选取地表矩形区域内的一个图格。

* 如果该格内方块类型为蘑菇草（ID 70）
  
  * 有**1 / 10**的几率长出小蘑菇。
  
  * 如果位于玩家附近，则有**1 / 200**的几率长出地下蘑菇树


#### 各类树木（普通、腐化、丛林、神圣、猩红、地表蘑菇、雪地）

丛林木高度上限为**21**，其余树木高度上限为**16**。

* 树根下方方块长有对应类型的草地，或是雪块。

* 树根下方的图格，其左右相邻的方块之一也符合该条件。

* 树根所在图格完全没有液体，除非树根下的方块为丛林草地。

* 树根所在格的背景墙为栅栏（各种木栅栏或金属栅栏），或无背景墙。

* 树根左右**2**格、上方**1 - 高度上限**格的矩形区域内没有方块。

符合上述条件后，将会生成一棵树，高度为**5 - 高度上限**中的随机数值。

从树根往上，每个图格都有几率出现树枝。只有左边有、只有右边有和左右都有树枝的几率均为**1 / 10**。同一边不会出现两个上下相邻的树枝。

树根下方左右相邻的图格里，符合第一点（长草或雪地）的方块上将会长出另一块树根。

#### 棕榈木

* 树根下方方块为沙块（普通、腐化、神圣、猩红之一）。

* 树根所在图格没有任何液体，也没有任何背景墙。

* 树根左右**1**格、上方**1 - 30**格的矩形区域内没有方块。

符合上述条件后，将会生成一棵树，高度为**10 - 21**中的随机数值。

#### 地下蘑菇树

* 所选取图格左上方和右上方没有岩浆（对正上方无要求，疑似Bug）。

* 所选取图格左右相邻的方块均为蘑菇草地。

* 所选取图格左右**2**格，上方**1 - 13**格的矩形区域内没有方块，自然生长的蘑菇（ID 71）除外。

符合上述条件后，将会生成一棵树，高度为**4 - 11**中的随机数值。